

<div id="map_canvas" style="width: 560px; height: 200px; overflow: hidden;"></div>
<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=<%= getmapsapikey(request.url) %>&sensor=true" type="text/javascript"></script>
<script type="text/javascript" charset="utf-8">
  var map = new GMap2(document.getElementById("map_canvas"));
  var custIcon = new GIcon(G_DEFAULT_ICON);
  custIcon.iconSize = new GSize(16, 16);
  custIcon.shadowSize = new GSize(20, 20);
  custIcon.iconAnchor = new GPoint(0, 0);
  custIcon.infoWindowAnchor = new GPoint(10,0);
  var dotIcon = new GIcon(custIcon, '/images/map_dot-20px.png');
 
  var sw = new GLatLng(<%=  51.500152 %>, <%= -0.126236  %>);
  var ne = new GLatLng(<%=  51.502152 %>, <%= -0.122236 %>);
  var bounds = new GLatLngBounds(sw,ne);
  map.setCenter(bounds.getCenter(), 12);
  map.enableInfoWindow()  
map.disableDragging() 


  map.setMapType(G_NORMAL_MAP);

GEvent.addListener(map, "click", function() {
  	window.location = "/search"
});

	$.ajax({
	    type: "GET",
	    url: '/search/map',
	    data: '', //advanced_search,
	    success: function(p) {
			var x = eval(p);
			var marker= new Array();
			for(var i =0; i < x.length; i++)
			{
				var point = new GLatLng(x[i].place.latitude, x[i].place.longitude)
				var marker = createMarker(point);
				map.addOverlay(marker);
			}
	    }
	});
	

  
	function createMarker(point) {
	        var marker = new GMarker(point,{ icon: dotIcon });
	        

	        return marker;
	      }
</script>
