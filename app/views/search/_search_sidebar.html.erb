<% form_tag search_people_path, :method => :get, :id => "advanced_search_side" do |f| %>
	<%= hidden_field_tag "t", params[:t] %>
	<div class="section_header">
		<div style="float:left;width:54px">
			<h3 class="section_name">Filter Results </h3>
		</div>
		<div class="section_extra"></div>
		<div class="clear">&nbsp;</div>
	</div>
	<div id="search_type"  style="text-align:center">
		<%= hidden_field_tag 'search_criteria[type]', @search_criteria.type, :id=>'search_criteria_type' %>
	    <div id="simple_search"   class="<%=search_type_simple_class(@search_criteria.type)%>"> Simple&nbsp;&nbsp;</div>&nbsp;
		<div id="advanced_search"  class="<%=search_type_advanced_class(@search_criteria.type)%>"> Advanced </div>
		<div id="map_search"  class="<%=search_type_map_class(@search_criteria.type)%>"> Map </div>
	</div>
	<div class="clear">&nbsp;</div>

	<div id="keyword_criteria"  style="padding:5px" class="<%=search_keyword_class(@search_criteria.type)%>" >
	   	<label  class="search_criteria_header" style="padding-top:0px">Keyword</label><br \>
		<%= text_field_tag 'search_criteria[keyword]', @search_criteria.keyword, :class => 'input_text'%><br />
	</div>
	
	<div id="people_header" style="font-size:14px; background-color:grey; color:white;">People</div>
	<div id='people_criteria' style="padding:5px" class="<%=search_people_class(@search_criteria.type)%>" >
	    <label class="search_criteria_header">Age</label><br \>
	    <% age_options.each do |opt| %>
	    	<%= check_box_tag "search_criteria[age_"+opt[1].to_s+"]", opt[1] , @search_criteria.ages.include?(opt[1]) %> <%= opt[0] %> <br \>
	    <% end %>
	    <label  class="search_criteria_header">Gender</label><br \>
		<%= check_box_tag "search_criteria[sp_1]",1, @search_criteria.sex_preferences.include?("1") %> Male <br \>
		<%= check_box_tag "search_criteria[sp_2]",2, @search_criteria.sex_preferences.include?("2")  %> Female<br \>
	</div>
	
	<div id="place_header" style="font-size:14px; background-color:grey; color:white;">Places</div>
	<div id='place_criteria'  style="padding:5px" class="<%=search_places_class(@search_criteria.type)%>" >
		<label class="search_criteria_header">Location</label><br \>
		<div class="float:left" id="postcodesearch">
		  	<%= drop_down('search_criteria[distance]', @search_criteria.distance, {:width => '100px'},distance_options, 'Any distance',0) %>
		   	<div class="clear"></div>
		    from 
			<%= text_field_tag 'search_criteria[postcode]', @search_criteria.postcode, :class => 'input_text' %><br />	
		</div>
	</div>
	
	<div id="activity_header" style="font-size:14px; background-color:grey; color:white;">Activities</div>
	<div id='activity_criteria'  style="padding:5px" class="<%=search_activities_class(@search_criteria.type)%>" >
		<label class="search_criteria_header">Activity</label><br \>
		<% activity_category_options.each do |opt| %>
			<%= check_box_tag "search_criteria[ac_"+opt[1].to_s+"]", opt[1] , @search_criteria.activity_categories.include?(opt[1]) %> <%= opt[0] %> <br \>
		<% end %>
	</div>
	<div id="advanced_search_submit" style="float:left;">
		<%= submit_button ("Search", :id=> "search_sidebar_button") %>    
	</div>
<% end %>

<script type="text/javascript" charset="utf-8">
	//todo: clean up this javascript
	var search_type = 1
	var submit = true

	$('#simple_search').live('click', function() {
		if($('#search_criteria_type').val() != "1")
		{
			$('#keyword_criteria').css("display","block");
		  	$('#people_criteria').css("display","block");
			$('#place_criteria').css("display","none");
			$('#activity_criteria').css("display","none");
			$('#search_criteria_type').val(1);
			$('#big_map').css("height","0px");
			
			$('#activity_container').css("display","none");
		    $('#people_container').css("display","none");
		    $('#object_container').css("display","block");
		    $('#map_container').css("display","none");
		
			$("#advanced_search_side").submit();
			$('#simple_search').addClass("search_type_selected");
			$('#simple_search').removeClass("search_type");
			$('#advanced_search').removeClass("search_type_selected").addClass("search_type");
	        $('#map_search').removeClass("search_type_selected").addClass("search_type");;
	        $('#keyword_criteria').css('display','block')
        }
	});
	$('#advanced_search').live('click', function() {
		if($('#search_criteria_type').val() != "4")
		{
			$('#keyword_criteria').css("display","none");
		  	$('#people_criteria').css("display","block");
			$('#place_criteria').css("display","block");
			$('#activity_criteria').css("display","block");
			$('#search_criteria_type').val(4);
			$('#big_map').css("height","0px");
			
			$('#activity_container').css("display","block");
		    $('#people_container').css("display","block");
		    $('#object_container').css("display","none");
		    $('#map_container').css("display","none");
		
			$("#advanced_search_side").submit();
			$('#advanced_search').addClass("search_type_selected");
			$('#advanced_search').removeClass("search_type");
			$('#simple_search').removeClass("search_type_selected").addClass("search_type");;
	        $('#map_search').removeClass("search_type_selected").addClass("search_type");;
			$('#keyword_criteria').css('display','none')

		}
	});
	$('#map_search').live('click', function() {
		if($('#search_criteria_type').val() != "5")
		{
			$('#keyword_criteria').css("display","none");
		  	$('#people_criteria').css("display","block");
			$('#place_criteria').css("display","block");
			$('#activity_criteria').css("display","block");
			$('#search_criteria_type').val(5);
		    $('#big_map').css("height","560px");

			$('#activity_container').css("display","none");
		    $('#people_container').css("display","none");
		    $('#object_container').css("display","none");
		    $('#map_container').css("display","block");
		
	     	$("#advanced_search_side").submit();
			$('#map_search').addClass("search_type_selected");
			$('#map_search').removeClass("search_type");
			$('#advanced_search').removeClass("search_type_selected").addClass("search_type");;
	        $('#simple_search').removeClass("search_type_selected").addClass("search_type");;
	        $('#keyword_criteria').css('display','none')
	}
	});


	$('#people_criteria').live('click', function() {
		if($('#search_criteria_type').val()!=4 && $('#search_criteria_type').val()!=5 ){
	    	$('#people_criteria').css("display","block");
	    	$('#place_criteria').css("display","none");
		    $('#activity_criteria').css("display","none");
		    $('#search_criteria_type').val(1);
	    }
	});
	$('#place_criteria').live('click', function() {
		if($('#search_criteria_type').val()!=4&& $('#search_criteria_type').val()!=5){
	    	$('#people_criteria').css("display","none");
	    	$('#place_criteria').css("display","block");
		    $('#activity_criteria').css("display","none");
	    	$('#search_criteria_type').val(2);
	    }
	});
	$('#activity_criteria').live('click', function() {
		if($('#search_criteria_type').val()!=4&& $('#search_criteria_type').val()!=5){
	    	$('#people_criteria').css("display","none");
	    	$('#place_criteria').css("display","none");
		    $('#activity_criteria').css("display","block");
			$('#search_criteria_type').val(3);
		}
	});	
	$('#people_header').live('click', function() {
		if($('#search_criteria_type').val()!=4 && $('#search_criteria_type').val()!=5 ){
	    	$('#people_criteria').css("display","block");
	    	$('#place_criteria').css("display","none");
		    $('#activity_criteria').css("display","none");
		    $('#search_criteria_type').val(1);
	    }
	});
	$('#place_header').live('click', function() {
		if($('#search_criteria_type').val()!=4&& $('#search_criteria_type').val()!=5){
	    	$('#people_criteria').css("display","none");
	    	$('#place_criteria').css("display","block");
		    $('#activity_criteria').css("display","none");
	    	$('#search_criteria_type').val(2);
	    }
	});
	$('#activity_header').live('click', function() {
		if($('#search_criteria_type').val()!=4&& $('#search_criteria_type').val()!=5){
	    	$('#people_criteria').css("display","none");
	    	$('#place_criteria').css("display","none");
		    $('#activity_criteria').css("display","block");
			$('#search_criteria_type').val(3);
		}
	});
	
    $("#advanced_search_side").submit(function() {
	    //todo: refactor this method too long
	    error = false;
		if($(this).attr('t')=="user_place_activity"){
		  var postcode = $('#postcode');
		  postcode.removeClass('invalid');
	   	  regexString = /^([A-PR-UWYZ0-9][A-HK-Y0-9][AEHMNPRTVXY0-9]?[ABEHMNPRVWXY0-9]? {1,2}[0-9][ABD-HJLN-UW-Z]{2}|GIR 0AA)$/
		  if ($('#distance').val() != 0 && (postcode.val() == '' || postcode.val() == 'Post code' || regexString.test(postcode.val().toUpperCase()) != true)) {
			postcode.addClass('invalid');
		    postcode.nextAll('span.error').text('Please enter a valid post code.');
		    error = true;
		  }
	    }

		if(!error) {
		  var people_url = "";
		  var objects_url = "";
		  var activities_url = "";
		  var map_url = "";
		  var type = $('#search_criteria_type').val();

		  switch(type) {
			case "1":
			  objects_url = "/search/people"
				$('#object_header').text('People')
			break;
			case "2":
			  objects_url = "/search/places"
				$('#object_header').text('Places');
			break;
			case "3":
			  objects_url = "/search/activities"
				$('#object_header').text('Activities');
			break;
			case "4":
			  activities_url = "/search/place_activities"
			  people_url = "/search/people_list"
			  break;
			case "5":
			  map_url = "/big_map"
			break;
		  }
	
          var dataString = $('#advanced_search_side').serialize();

    	  if(people_url.length>0) {
		    $.ajax({
		      type: "GET",
		      url: people_url,
		      data: $('#advanced_search_side').serialize(), //advanced_search,
		      success: function(p) {
		        $('#people_results').html(p);
			
		      }
		    });
		  }
	   	  if(activities_url.length>0){
			$.ajax({
		    	type: "GET",
		    	url: activities_url,
		    	data: $('#advanced_search_side').serialize(), //advanced_search,
		    	success: function(p) {
			  		$('#activity_results').html(p);
		    	}
			});
		  }
	   	  if(objects_url.length>0){
			$.ajax({
		    	type: "GET",
		    	url: objects_url,
		    	data: $('#advanced_search_side').serialize(), //advanced_search,
		    	success: function(p) {
			  		$('#object_results').html(p);
		    	}
			});
		  }
		  if(map_url.length>0){
			map.clearOverlays();
			var sw = new GLatLng(<%=  51.500152 %>, <%= -0.126236  %>);
			var ne = new GLatLng(<%=  51.502152 %>, <%= -0.122236 %>);
			var bounds = new GLatLngBounds(sw,ne);
			var ma = new GMarker(bounds.getCenter(), { icon: dotIcon });
			$.ajax({
			    type: "GET",
			    url: '/search/map',
			    data: $('#advanced_search_side').serialize(), //advanced_search,
			    success: function(p) {
					var x = eval(p);
					var marker= new Array();
					for(var i =0; i < x.length; i++)
					{
						var point = new GLatLng(x[i].place.latitude, x[i].place.longitude)
						var marker = createMarker(point,place_html(x[i].place));
						map.addOverlay(marker);
					}
			    }
			});
		  }
	    }
		return false;
	});


function place_html(pl)
{
	return pl.name
}
function createMarker(point,html) {
        var marker = new GMarker(point,{ icon: dotIcon });
        GEvent.addListener(marker, "click", function() {
          marker.openInfoWindowHtml(html);
        });

        // The new marker "mouseover" listener        
        GEvent.addListener(marker,"mouseover", function() {
          marker.openInfoWindowHtml(html);
        });   
		GEvent.addListener(marker,"mouseout", function() {
          marker.closeInfoWindow();
        });     
        
        return marker;
      }


</script>















<!--
<label  class="search_criteria_header">Date</label><br \>
between<br \>
<%= hidden_field_tag 'startdate', current_user.dob %>
<span>
<div class='search_fancy_select', style="width:40px; float:left">
	<%= hidden_field_tag 'day',current_user.dob.day %>
	<div class="fancy_select_target">
	   	<%= current_user.dob.day()%>
	</div>
	<div class="fancy_select_options" , style="width:40px">
    		<% (1..31).each do|m|%>
				<p><%=m%> <span class="hidden_value"><%= m %></span></p>
			<% end %>
	</div>
  </div
  <div class='fancy_select', style="width:45px; float:left">
	<%= hidden_field_tag 'month',current_user.dob.month  %>
  	<div class="fancy_select_target">
	   	<%= Date::MONTHNAMES[current_user.dob.month].to_s[0..2]%>
	</div>
	<div class="fancy_select_options", style="width:56px">
		<% i = 0 %>
    		<% Date::MONTHNAMES.each do|m|%>
				<p><%=m.to_s[0..2]%> <span class="hidden_value"><%= i %></span></p>
				  <% i+=1 %>
			<% end %>
	</div>
</div>
  <div class='fancy_select' , style="width:50px; float:left">
		<%= hidden_field_tag 'year',current_user.dob.year %>	
  	<div class="fancy_select_target" >
	  <%= current_user.dob.year()%>
	</div>
	<div class="fancy_select_options" , style="width:50px">
    		<% (DateTime.now.year-18).downto(DateTime.now.year - 100) do|m|%>
				<p><%=m%> <span class="hidden_value"><%= m %></span></p>
			<% end %>
	</div>
	</div>
</span>
<div class="clear"></div>
and <br />
<span>
<%= hidden_field_tag 'enddate', current_user.dob %>	
<div class='fancy_select', style="width:40px; float:left">
	<%= hidden_field_tag 'endday',current_user.dob.day %>
	<div class="fancy_select_target">
	   	<%= current_user.dob.day()%>
	</div>
	<div class="fancy_select_options" , style="width:40px">
    		<% (1..31).each do|m|%>
				<p><%=m%> <span class="hidden_value"><%= m %></span></p>
			<% end %>
	</div>
  </div
  <div class='fancy_select', style="width:45px; float:left">
	<%= hidden_field_tag 'endmonth',current_user.dob.month  %>
  	<div class="fancy_select_target">
	   	<%= Date::MONTHNAMES[current_user.dob.month].to_s[0..2]%>
	</div>
	<div class="fancy_select_options", style="width:56px">
		<% i = 0 %>
    		<% Date::MONTHNAMES.each do|m|%>
				<p><%=m.to_s[0..2]%> <span class="hidden_value"><%= i %></span></p>
				  <% i+=1 %>
			<% end %>
	</div>
</div>
  <div class='fancy_select' , style="width:50px; float:left">
		<%= hidden_field_tag 'endyear',current_user.dob.year %>	
  	<div class="fancy_select_target" >
	  <%= current_user.dob.year()%>
	</div>
	<div class="fancy_select_options" , style="width:50px">
    		<% (DateTime.now.year-18).downto(DateTime.now.year - 100) do|m|%>
				<p><%=m%> <span class="hidden_value"><%= m %></span></p>
			<% end %>
	</div>
	</div>
</span>
-->