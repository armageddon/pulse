<% form_tag search_people_path, :method => :get, :id => "advanced_search_side" do |f| %>
<%= hidden_field_tag "t", params[:t] %>
<div class="section_header">
	<div style="float:left;width:54px">
		<h3 class="section_name">Filter Results </h3>
	</div>
	<div class="section_extra"></div>
	<div class="clear">&nbsp;</div>
</div>
<%= hidden_field_tag 'search_criteria[type]', @search_criteria.type, :id=>'search_criteria_type' %>
<div id="search_type"  style="text-align:center">
<div id="simple_search"   style="font-weight:bold; float:left"> Simple </div>
<div id="advanced_search"  style="font-weight:bold; float:right"> Advanced </div>
</div>
<div class="clear">&nbsp;</div>

<div id="keyword_criteria" style="background-color:lightgrey; padding:5px">
<label  class="search_criteria_header" style="padding-top:0px">Keyword</label><br \>
<%= text_field_tag 'search_criteria[keyword]', @search_criteria.keyword, :class => 'input_text'%><br />
</div>
<div id='people_criteria' style="background-color:lightgrey">	
    <label class="search_criteria_header">Age</label><br \>

    <% age_options.each do |opt| %>
    	<%= check_box_tag "search_criteria[age_"+opt[1].to_s+"]", opt[1] , @search_criteria.ages.include?(opt[1]) %> <%= opt[0] %> <br \>
    <% end %>

    <label  class="search_criteria_header">Gender</label><br \>
	<%= check_box_tag "search_criteria[sp1]",1, @search_criteria.sex_preferences.include?(1) %> Female <br \>
	<%= check_box_tag "search_criteria[sp2]",2, @search_criteria.sex_preferences.include?(2)  %> Male<br \>
</div>
<div id='place_criteria' style="padding:5px">
<div class="float:left" id="postcodesearch">
	<label class="search_criteria_header">Location</label><br \>	
  	<%= drop_down('search_criteria[distance]', @search_criteria.distance, {:width => '100px'},distance_options, 'Any distance',0) %>
   	<div class="clear"></div>
    from 
	<%= text_field_tag 'search_criteria[postcode]', @search_criteria.postcode, :class => 'input_text' %><br />	
</div>
</div>
<div id='activity_criteria' style="padding:5px" >
<label class="search_criteria_header">Activity</label><br \>

<% activity_category_options.each do |opt| %>
	<%= check_box_tag "search_criteria[ac_"+opt[1].to_s+"]", opt[1] , @search_criteria.activity_categories.include?(opt[1]) %> <%= opt[0] %> <br \>
<% end %>
</div>
<div id="advanced_search_submit" style="float:left;">
	<%= submit_button ("Search", :id=> "search_sidebar_button") %>    
</div>

<% end %>

<script type="text/javascript" charset="utf-8">
	//todo: clean up this javascript
	var search_type = 1
	var submit = true

	$('#simple_search').live('click', function() {
		$('#keyword_criteria').css('background-color','lightgrey');
	  	$('#people_criteria').css('background-color','lightgrey');
		$('#place_criteria').css('background-color','white');
		$('#activity_criteria').css('background-color','white');
		$('#search_criteria_type').val(1);
	});
	
	$('#advanced_search').live('click', function() {
		$('#keyword_criteria').css('background-color','white');
	  	$('#people_criteria').css('background-color','lightgrey');
		$('#place_criteria').css('background-color','lightgrey');
		$('#activity_criteria').css('background-color','lightgrey');
		$('#search_criteria_type').val(4);
	});

	$('#people_criteria').live('click', function() {
		if($('#search_criteria_type').val()!=4){
	    	$('#people_criteria').css('background-color','lightgrey');
	    	$('#place_criteria').css('background-color','white');
		    $('#activity_criteria').css('background-color','white');
		    $('#search_criteria_type').val(1);
	    }
	});
	$('#place_criteria').live('click', function() {
		if($('#search_criteria_type').val()!=4){
		    $('#people_criteria').css('background-color','white');
		    $('#place_criteria').css('background-color','lightgrey');
		    $('#activity_criteria').css('background-color','white');
	    	$('#search_criteria_type').val(2);
	    }
	});
	$('#activity_criteria').live('click', function() {
		if($('#search_criteria_type').val()!=4){
			$('#people_criteria').css('background-color','white');
			$('#place_criteria').css('background-color','white');
			$('#activity_criteria').css('background-color','lightgrey');
			$('#search_criteria_type').val(3);
		}
	});	
	
	$("#advanced_search_side").submit(function() {
	    error = false;
		if($(this).attr('t')=="user_place_activity"){
		  var postcode = $('#postcode');
		  postcode.removeClass('invalid');
	   	  regexString = /^([A-PR-UWYZ0-9][A-HK-Y0-9][AEHMNPRTVXY0-9]?[ABEHMNPRVWXY0-9]? {1,2}[0-9][ABD-HJLN-UW-Z]{2}|GIR 0AA)$/
		  if ($('#distance').val() != 0 && (postcode.val() == '' || postcode.val() == 'Post code' || regexString.test(postcode.val().toUpperCase()) != true)) {
			postcode.addClass('invalid');
		    postcode.nextAll('span.error').text('Please enter a valid post code.');
		    error = true;
		  }
	    }

	    if(!error) {
		  //if search type = 1 call people
		  var top_url = "";
		  var bottom_url = "";
	
		  var type = $('#search_criteria_type').val();
		  switch(type) {
			case "1":
			  bottom_url = "/search/people"
			break;
			case "2":
			  bottom_url = "/search/places"
			break;
			case "3":
			  bottom_url = "/search/activities"
			break;
			case "4":
			  bottom_url = "/search/place_activities"
			  top_url = "search/people_list/"
			break;
		  }
	
	        var dataString = $('#advanced_search_side').serialize();
	    	if(top_url.length>0) {
			$.ajax({
			    type: "GET",
			    url: top_url,
			    data: $('#advanced_search_side').serialize(), //advanced_search,
			    success: function(p) {
				  $('#results').replaceWith(p);
			    }
			  });
			}
			else{
				$('#results').replaceWith("<div id='results'></div>");
			}
			if(bottom_url.length>0){
			$.ajax({
			    type: "GET",
			    url: bottom_url,
			    data: $('#advanced_search_side').serialize(), //advanced_search,
			    success: function(p) {
				  $('#activity_results').replaceWith(p);
				  $("#dialog").jqmAddTrigger('.add_to_favorites, .add_event, .add_activity');
			    }
			});
	    }
    }
    return false;
});


</script>

















<!--
<label  class="search_criteria_header">Date</label><br \>
between<br \>
<%= hidden_field_tag 'startdate', current_user.dob %>
<span>
<div class='search_fancy_select', style="width:40px; float:left">
	<%= hidden_field_tag 'day',current_user.dob.day %>
	<div class="fancy_select_target">
	   	<%= current_user.dob.day()%>
	</div>
	<div class="fancy_select_options" , style="width:40px">
    		<% (1..31).each do|m|%>
				<p><%=m%> <span class="hidden_value"><%= m %></span></p>
			<% end %>
	</div>
  </div
  <div class='fancy_select', style="width:45px; float:left">
	<%= hidden_field_tag 'month',current_user.dob.month  %>
  	<div class="fancy_select_target">
	   	<%= Date::MONTHNAMES[current_user.dob.month].to_s[0..2]%>
	</div>
	<div class="fancy_select_options", style="width:56px">
		<% i = 0 %>
    		<% Date::MONTHNAMES.each do|m|%>
				<p><%=m.to_s[0..2]%> <span class="hidden_value"><%= i %></span></p>
				  <% i+=1 %>
			<% end %>
	</div>
</div>
  <div class='fancy_select' , style="width:50px; float:left">
		<%= hidden_field_tag 'year',current_user.dob.year %>	
  	<div class="fancy_select_target" >
	  <%= current_user.dob.year()%>
	</div>
	<div class="fancy_select_options" , style="width:50px">
    		<% (DateTime.now.year-18).downto(DateTime.now.year - 100) do|m|%>
				<p><%=m%> <span class="hidden_value"><%= m %></span></p>
			<% end %>
	</div>
	</div>
</span>
<div class="clear"></div>
and <br />
<span>
<%= hidden_field_tag 'enddate', current_user.dob %>	
<div class='fancy_select', style="width:40px; float:left">
	<%= hidden_field_tag 'endday',current_user.dob.day %>
	<div class="fancy_select_target">
	   	<%= current_user.dob.day()%>
	</div>
	<div class="fancy_select_options" , style="width:40px">
    		<% (1..31).each do|m|%>
				<p><%=m%> <span class="hidden_value"><%= m %></span></p>
			<% end %>
	</div>
  </div
  <div class='fancy_select', style="width:45px; float:left">
	<%= hidden_field_tag 'endmonth',current_user.dob.month  %>
  	<div class="fancy_select_target">
	   	<%= Date::MONTHNAMES[current_user.dob.month].to_s[0..2]%>
	</div>
	<div class="fancy_select_options", style="width:56px">
		<% i = 0 %>
    		<% Date::MONTHNAMES.each do|m|%>
				<p><%=m.to_s[0..2]%> <span class="hidden_value"><%= i %></span></p>
				  <% i+=1 %>
			<% end %>
	</div>
</div>
  <div class='fancy_select' , style="width:50px; float:left">
		<%= hidden_field_tag 'endyear',current_user.dob.year %>	
  	<div class="fancy_select_target" >
	  <%= current_user.dob.year()%>
	</div>
	<div class="fancy_select_options" , style="width:50px">
    		<% (DateTime.now.year-18).downto(DateTime.now.year - 100) do|m|%>
				<p><%=m%> <span class="hidden_value"><%= m %></span></p>
			<% end %>
	</div>
	</div>
</span>
-->