
<% content_for :c1 do %>
   <%= render :partial => "search_sidebar" %>
<% end %>

<% content_for :c3 do %>
  <%= render :partial => "skyscraper" %>
<% end %>



<% form_tag search_path, :method => :get, :id => "advanced_search" do %>
	<div id="results" style="float:left;width:560px">
		<div class="section_header">
			<div style="float:left;width:200px">
				<h3 style="width:100px;" class="section_name"><span id="results_header">Results</span></h3>
			</div>
			<div class="clear">&nbsp;</div>
		</div>	
		Enter some search criteria above
	</div>
	<div class="clear">&nbsp;</div>
	<br \>
	<div id="activity_results" style="float:left;width:560px">
		<div class="section_header">
			<div style="float:left;width:200px">
				<h3 class="section_name"><span id="results_header">Activities: Page 1 of 1</span></h3>
			</div>
			<div class="clear">&nbsp;</div>
		</div>	
		Enter some search criteria above
	</div>
<% end %>


<script type="text/javascript" charset="utf-8">
//todo: clean up this javascript
$("#advanced_search").submit(function() {
	error = false;
	if($(this).attr('t')=="user_place_activity")
	{
	  var postcode = $('#postcode');
	  postcode.removeClass('invalid');
   	  regexString = /^([A-PR-UWYZ0-9][A-HK-Y0-9][AEHMNPRTVXY0-9]?[ABEHMNPRVWXY0-9]? {1,2}[0-9][ABD-HJLN-UW-Z]{2}|GIR 0AA)$/
	  if ($('#distance').val() != 0 && (postcode.val() == '' || postcode.val() == 'Post code' || regexString.test(postcode.val().toUpperCase()) != true)) {
		postcode.addClass('invalid');
	    postcode.nextAll('span.error').text('Please enter a valid post code.');
	    error = true;
	  }
    }
    if(!error) {
	  $.ajax({
	    type: "GET",
	    url: $(this).attr('action'),
	    data: $('#advanced_search').serialize(), //advanced_search,
	    success: function(p) {
		 $('#results').replaceWith(p);
		$("#dialog").jqmAddTrigger('.add_to_favorites, .add_event, .add_activity');
	    }
	 });
  }
  return false;
});

$("#people_link").click(function() {
	$('#t').val('people');
  $.ajax({
    type: "GET",
    url: "/search/people",
    data: $('#advanced_search').serialize(),
    success: function(p) {
      $('#search_criteria').replaceWith(p);
      toggle('people');
	$.ajax({
    type: "GET",
    url: $(this).attr('action'),
    data: $('#advanced_search').serialize(),
    success: function(p) {
	 $('#results').replaceWith(p);
	$("#dialog").jqmAddTrigger('.add_to_favorites, .add_event, .add_activity');
    }
  });

    }
  });
	
  return false;
});

$("#places_link").click(function() {
	$('#t').val('places');
  $.ajax({
    type: "GET",
    url: "/search/places",
     data: $('#advanced_search').serialize(),
    success: function(p) {
      $('#search_criteria').replaceWith(p);
      toggle('places');
	  $.ajax({
		type: "GET",
		url: $(this).attr('action'),
		data: $('#advanced_search').serialize(),
		success: function(p) {
		$('#results').replaceWith(p);
		$("#dialog").jqmAddTrigger('.add_to_favorites, .add_event, .add_activity');
		}
	   });
    }
  });

  return false;
});

$("#activities_link").click(function() {
	$('#t').val('activities');
  $.ajax({
    type: "GET",
    url: "/search/activities",
    data: $('#advanced_search').serialize(),
    success: function(p) {
      $('#search_criteria').replaceWith(p);
      toggle('activities');
	$.ajax({
	    type: "GET",
	    url: $(this).attr('action'),
	   data:  $('#advanced_search').serialize(),
	    success: function(p) {
		 $('#results').replaceWith(p);
		$("#dialog").jqmAddTrigger('.add_to_favorites, .add_event, .add_activity');
	    }
	  });


    }
  });

  return false;
});

function toggle(t) {
	$('#places_link').css("color", "#990000");
	$('#people_link').css("color", "#990000");
	$('#activities_link').css("color", "#990000");
	$('#'+t+'_link').css("color", "#000000");
	
}

</script>